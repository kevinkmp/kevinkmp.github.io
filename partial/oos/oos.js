angular.module('kevinkmp').controller('OutOfStockCtrl', function ($scope, $http, $timeout){



var oosJson, data, dataCombo, dataOOS;

oosJson = {
  "title" : "Lost Revenue (0.000000 sigma),Lost Revenue (0.500000 sigma),Lost Revenue (1.000000 sigma),Lost Revenue (1.500000 sigma),Lost Revenue (2.000000 sigma),Lost Revenue (2.500000 sigma) by Product UPC by Meal by Day of the Week, 2015-09-01 to 2015-12-31",
  "dimensions" : [ {
    "dimensionName" : "Product UPC",
    "dimensionType" : "STRING"
  }, {
    "dimensionName" : "Meal",
    "dimensionType" : "STRING"
  }, {
    "dimensionName" : "Day of the Week",
    "dimensionType" : "DAY_OF_WEEK"
  } ],
  "facts" : [ {
    "factName" : "Lost Revenue (0.000000 sigma)",
    "factType" : "DOLLAR"
  }, {
    "factName" : "Lost Revenue (0.500000 sigma)",
    "factType" : "DOLLAR"
  }, {
    "factName" : "Lost Revenue (1.000000 sigma)",
    "factType" : "DOLLAR"
  }, {
    "factName" : "Lost Revenue (1.500000 sigma)",
    "factType" : "DOLLAR"
  }, {
    "factName" : "Lost Revenue (2.000000 sigma)",
    "factType" : "DOLLAR"
  }, {
    "factName" : "Lost Revenue (2.500000 sigma)",
    "factType" : "DOLLAR"
  } ],
  "jobId" : "job_39EGKRxOXh6qhcNxsYB5O6_igCY",
  "values" : {
    "1820053168" : {
      "1_BREAKFAST" : {
        "3" : [ 1117.67672266431100069894455373287200927734375, 0, 0, 0, 0, 0 ],
        "2" : [ 807.6009195402317573098116554319858551025390625, 7.93430034147505214292550590471364557743072509765625, 0, 0, 0, 0 ],
        "1" : [ 903.44834659593425385537557303905487060546875, 0, 0, 0, 0, 0 ],
        "7" : [ 1595.473070414049516330123879015445709228515625, 24.46839464094724547749137855134904384613037109375, 0, 0, 0, 0 ],
        "6" : [ 4506.74348732677390216849744319915771484375, 14.9805111831853512427414898411370813846588134765625, 0, 0, 0, 0 ],
        "5" : [ 2133.578204707171607878990471363067626953125, 2.6633103877274759696547334897331893444061279296875, 0, 0, 0, 0 ],
        "4" : [ 1256.960574712644529427052475512027740478515625, 0, 0, 0, 0, 0 ]
      },
      "4_EVENING" : {
        "3" : [ 11513.071844483331005903892219066619873046875, 1318.700491595655648779938928782939910888671875, 13.9402767738679127518253153539262712001800537109375, 0, 0, 0 ],
        "2" : [ 9041.129089702852070331573486328125, 746.1901602473217280930839478969573974609375, 0, 0, 0, 0 ],
        "1" : [ 7941.2979585648963620769791305065155029296875, 625.1868529262836773341405205428600311279296875, 0, 0, 0, 0 ],
        "7" : [ 9324.304556923461859696544706821441650390625, 651.6099807663676983793266117572784423828125, 0, 0, 0, 0 ],
        "6" : [ 28301.4898801054732757620513439178466796875, 10360.943028345920538413338363170623779296875, 707.5340291155056320349103771150112152099609375, 0, 0, 0 ],
        "5" : [ 27107.12076643365799100138247013092041015625, 9981.059816088711158954538404941558837890625, 593.5284215269830383476801216602325439453125, 0, 0, 0 ],
        "4" : [ 13130.482962413172572269104421138763427734375, 1885.259331877193062609876506030559539794921875, 17.945239849435100865093772881664335727691650390625, 0, 0, 0 ]
      },
      "0_OVERRNIGHT" : {
        "3" : [ 2093.5600163529370547621510922908782958984375, 15.3980221197911912867084538447670638561248779296875, 0, 0, 0, 0 ],
        "2" : [ 1877.4490452083382479031570255756378173828125, 10.9381741736719693136592468363232910633087158203125, 0, 0, 0, 0 ],
        "1" : [ 2162.2015084584536452894099056720733642578125, 60.68517642253414834385694121010601520538330078125, 0, 0, 0, 0 ],
        "7" : [ 11003.998950555498595349490642547607421875, 2140.60836292084923115908168256282806396484375, 143.295281179301809970638714730739593505859375, 0, 0, 0 ],
        "6" : [ 9209.62827362751340842805802822113037109375, 1703.042320667913600118481554090976715087890625, 119.873269420506261440095840953290462493896484375, 0, 0, 0 ],
        "5" : [ 3241.07954941595744458027184009552001953125, 153.928088723684396654789452441036701202392578125, 0, 0, 0, 0 ],
        "4" : [ 2878.4529385954620011034421622753143310546875, 136.239015200730563037723186425864696502685546875, 0, 0, 0, 0 ]
      },
      "3_RUSH_HOUR" : {
        "3" : [ 18904.78935377628658898174762725830078125, 5475.8567903562288847751915454864501953125, 288.0780248697011529657174833118915557861328125, 28.055542166400613268706365488469600677490234375, 0, 0 ],
        "2" : [ 17138.01125418415176682174205780029296875, 5048.4567223600824945606291294097900390625, 415.48992377690547073143534362316131591796875, 0, 0, 0 ],
        "1" : [ 14824.9668110965649248100817203521728515625, 3859.7854541758415507501922547817230224609375, 249.1449175687433807979687117040157318115234375, 0, 0, 0 ],
        "7" : [ 14312.062688843312571407295763492584228515625, 3139.6817372293453445308841764926910400390625, 74.5137049665216437688286532647907733917236328125, 0, 0, 0 ],
        "6" : [ 26764.4161076893724384717643260955810546875, 10203.24335856229663477279245853424072265625, 875.199711366715519034187309443950653076171875, 0, 0, 0 ],
        "5" : [ 32939.4820622528568492271006107330322265625, 15279.49294428430221159942448139190673828125, 3123.85486256663125459454022347927093505859375, 327.270986524947829821030609309673309326171875, 0, 0 ],
        "4" : [ 21224.5063319209657493047416210174560546875, 6860.1923209524220510502345860004425048828125, 546.3959899972169296233914792537689208984375, 82.59206174266745392742450349032878875732421875, 0, 0 ]
      },
      "2_LUNCH" : {
        "3" : [ 5977.5646197237556407344527542591094970703125, 194.98622456138679126524948514997959136962890625, 0, 0, 0, 0 ],
        "2" : [ 4849.685525494060129858553409576416015625, 199.8221595039385647396557033061981201171875, 0, 0, 0, 0 ],
        "1" : [ 5433.913360534528692369349300861358642578125, 325.681970461877654088311828672885894775390625, 0, 0, 0, 0 ],
        "7" : [ 11853.6028001360245980322360992431640625, 2101.94536238309274267521686851978302001953125, 19.49894904042226784213198698125779628753662109375, 0, 0, 0 ],
        "6" : [ 19757.87391163751090061850845813751220703125, 5171.3749602519355903496034443378448486328125, 162.46674637372353799946722574532032012939453125, 0, 0, 0 ],
        "5" : [ 11574.43530054364237003028392791748046875, 1419.548401543643876721034757792949676513671875, 0, 0, 0, 0 ],
        "4" : [ 7343.2859602702001211582683026790618896484375, 267.133411791863863982143811881542205810546875, 0, 0, 0, 0 ]
      }
    }
  },
  "dimensionValues" : [ [ "1820053168" ], [ "0_OVERRNIGHT", "1_BREAKFAST", "2_LUNCH", "3_RUSH_HOUR", "4_EVENING" ], [ "1", "2", "3", "4", "5", "6", "7" ] ],
  "populated" : true
};

dataOOS = {
  columns: [
    ''
  ]
};

data = {
  columns: [
    ['data1', 30, 40, 50, 100, 125],
    ['data2', 225, 140, 150, 100, 75]
  ]
};

dataCombo = {
  columns: [
    ['Overnight', 2162.20, 22.98, 9.55, 0, 0],
    ['Breakfast', 177.32, 140, 150, 100, 75],
    ['Lunch', 225, 140, 150, 100, 75],
    ['Rush Hour', 225, 140, 150, 100, 75],
    ['Evening', 225, 140, 150, 100, 75],
  ],
  type: 'bar',
  groups: [
    ['Overnight','Breakfast','Lunch','Rush Hour','Evening']
  ]
};

function massageOOS () {

  var summaryValues = angular.copy(oosJson.values);

  angular.forEach(oosJson.values, function (meals, upcIndex) {

    angular.forEach(meals, function (days, mealIndex) {

      angular.forEach(days, function (sigmas, dayIndex) {

        var total = 0;
        angular.forEach(sigmas, function (sigmaScore) {
          total += sigmaScore;
        })

        summaryValues[upcIndex][mealIndex][dayIndex] = total;
        console.log(upcIndex + '.' + mealIndex + '.' + dayIndex + ': ' + total);

      });

    });

  });

  console.log("summaryValues: ", summaryValues);

  // what it should be:
  var oosChartData = {
    columns: [
      ['Overnight (total)', 2222.886684880988, 1888.3872193820102, 2108.9580384727283, 3014.6919537961926, 3395.007638139642, 11032.543863715933, 13287.90259465565],
      ['Breakfast (total)', 903.4483465959343, 815.5352198817068, 1117.676722664311, 1256.9605747126445, 2136.241515094899, 4521.7239985099595, 1619.9414650549968],
      ['Lunch (total)', 5759.595330996406, 5049.507684997999, 6172.550844285142, 7610.419372062064, 12993.983702087286, 25091.71561826317, 13975.04711155954],
      ['Rush Hour (total)', 18933.897182841152, 22601.95790032114, 24696.779711168616, 28713.686704613272, 51670.10085562874, 37842.85917761839, 17526.25813103918],
      ['Evening (total)', 8566.48481149118, 9787.319249950175, 12845.712612852854, 15033.6875341398, 37681.70900404936, 39369.966937566904, 9975.91453768983]
    ], 
    type: 'bar',
    groups: [
      ['Overnight (total)','Breakfast (total)','Lunch (total)','Rush Hour (total)','Evening (total)']
    ]
  }

  return oosChartData;
}

function getOosChartData2() {
  var oosChartData = {
    columns: [
      ['Overnight (total)', 2222.886684880988, 1888.3872193820102, 2108.9580384727283, 3014.6919537961926, 3395.007638139642, 11032.543863715933, 13287.90259465565],
      ['Breakfast (total)', 903.4483465959343, 815.5352198817068, 1117.676722664311, 1256.9605747126445, 2136.241515094899, 4521.7239985099595, 1619.9414650549968],
      ['Lunch (total)', 5759.595330996406, 5049.507684997999, 6172.550844285142, 7610.419372062064, 12993.983702087286, 25091.71561826317, 13975.04711155954],
      ['Rush Hour (total)', 18933.897182841152, 22601.95790032114, 24696.779711168616, 28713.686704613272, 51670.10085562874, 37842.85917761839, 17526.25813103918],
      ['Evening (total)', 8566.48481149118, 9787.319249950175, 12845.712612852854, 15033.6875341398, 37681.70900404936, 39369.966937566904, 9975.91453768983],

      ['sigma000Breakfast', 903.44834659593425385537557303905487060546875, 807.6009195402317573098116554319858551025390625, 1117.67672266431100069894455373287200927734375, 1256.960574712644529427052475512027740478515625, 2133.578204707171607878990471363067626953125, 4506.74348732677390216849744319915771484375, 1595.473070414049516330123879015445709228515625],
      ['sigma050Breakfast', 0, 7.93430034147505214292550590471364557743072509765625, 0, 0, 2.6633103877274759696547334897331893444061279296875, 14.9805111831853512427414898411370813846588134765625, 24.46839464094724547749137855134904384613037109375],
      ['sigma100Breakfast', 0, 0, 0, 0, 0, 0, 0],
      ['sigma150Breakfast', 0, 0, 0, 0, 0, 0, 0],
      ['sigma200Breakfast', 0, 0, 0, 0, 0, 0, 0],
      ['sigma250Breakfast', 0, 0, 0, 0, 0, 0, 0],

      ['sigma000Lunch', 5433.913360534528692369349300861358642578125, 4849.685525494060129858553409576416015625, 5977.5646197237556407344527542591094970703125, 7343.2859602702001211582683026790618896484375, 11574.43530054364237003028392791748046875, 19757.87391163751090061850845813751220703125, 11853.6028001360245980322360992431640625],
      ['sigma050Lunch', 325.681970461877654088311828672885894775390625, 199.8221595039385647396557033061981201171875, 194.98622456138679126524948514997959136962890625, 267.133411791863863982143811881542205810546875, 1419.548401543643876721034757792949676513671875, 5171.3749602519355903496034443378448486328125, 2101.94536238309274267521686851978302001953125],
      ['sigma100Lunch', 0, 0, 0, 0, 0, 162.46674637372353799946722574532032012939453125, 19.49894904042226784213198698125779628753662109375],
      ['sigma150Lunch', 0, 0, 0, 0, 0, 0, 0],
      ['sigma200Lunch', 0, 0, 0, 0, 0, 0, 0],
      ['sigma250Lunch', 0, 0, 0, 0, 0, 0, 0]

      
      
    ], 
    type: 'bar',
    types: {
      sigma000Breakfast: 'area-spline',
      sigma050Breakfast: 'area-spline',
      sigma100Breakfast: 'area-spline',
      sigma150Breakfast: 'area-spline',
      sigma200Breakfast: 'area-spline',
      sigma250Breakfast: 'area-spline',

      sigma000Lunch: 'area-spline',
      sigma050Lunch: 'area-spline',
      sigma100Lunch: 'area-spline',
      sigma150Lunch: 'area-spline',
      sigma200Lunch: 'area-spline',
      sigma250Lunch: 'area-spline',
    },
    groups: [
      ['Overnight (total)','Breakfast (total)','Lunch (total)','Rush Hour (total)','Evening (total)']
      // ,['sigma000Breakfast','sigma050Breakfast','sigma100Breakfast','sigma150Breakfast','sigma200Breakfast','sigma250Breakfast',]
    ]

    
  }

  return oosChartData;
}


function drawChart(domNodeId, data) {
  var chart = c3.generate({
    bindto: domNodeId,
    data: data
  });
}

drawChart('#chart1', data);

drawChart('#chart2', dataCombo);

drawChart('#chartOOS', massageOOS());

drawChart('#chartOOS2', getOosChartData2());

$scope.drawChart = drawChart;

});
